<!DOCTYPE html>
<html>
<head>
    <script src="MainViewSkript.js"></script>
    <meta http-equiv="content-type" content="text/html; charset=utf-8">
    <title>SQL Insekten</title>

    <link href="stylesheet.css" rel="stylesheet">
    <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/bootstrap/3.0.2/css/bootstrap.min.css">
    <!-- highlight js -->
    <link rel="stylesheet" href="highlight/styles/base16/railscasts.min.css">
    <script src="highlight/highlight.min.js"></script>
    <script>hljs.highlightAll();</script>

</head>
<body>

    <div class='top'>
        <img id='logo' src="img/OTH_Logo.png"/>
        <h2 id='lvl'>Level: 1</h2>
        <h2 id='hints'>Tipps: 
            <img id='light1' src="img/light.png" /> 
            <img id='light2' src="img/light.png"/>
            <img id='light3' src="img/light.png"/></h2>
        <h2 id='title'>SQL - Insekten</h2>
    </div>

    <div class='leftside'>
    
        <div class='sprechblase'>
            <h2 id='speakbubble_h2'> Willkommen bei SQL-Insekten!</h2>
            <h3>
            <h3 id='speakbubble_h3'> Dies ist ein SQL-Injection-Lernspiel. Mit SQL-Injections (dt. SQL-Einschleußung) kann man Websites hacken,
                 indem man durch das Einschleusen von SQL-Code beliebige Daten in der Datenbank ändern, löschen oder auslesen kann. </h3>
            
                
            </h3>
            <button class="btn btn-lg btn-primary btn-block" id='next_btn' type="submit" onclick="speakbubble_next()">Weiter</button>
        

        </div>

        <div class='animal'> 
            <img id='insect' src="img/bee.png"/>
        </div>

    </div>
    <div class='rightside'>
        <div class='rstop'>

            <div class="wrapper">
                <form class="form-signin">       
                    
                  <h2 id='loginlabel' class="form-signin-heading">Bitte einloggen</h2>
                  <input type="text" class="form-control" name="username" placeholder="Benutzername" id='username' required="" oninput="generate_query(); hljs.highlightAll();" onKeyPress="onEnter(event); generate_query(); hljs.highlightAll();" />
                  <input type="password" class="form-control" name="password" placeholder="Passwort" id='password' required="" oninput="generate_query(); hljs.highlightAll();" onKeyPress="onEnter(event); generate_query();hljs.highlightAll();"/>      
                  <button class="btn btn-lg btn-primary btn-block" id="login_btn" type="button" onclick="try_login();hljs.highlightAll();">Einloggen</button>  
                    
                  <input type="text" class="form-control" name="suchleiste" placeholder="" id='suchleiste' required="" oninput="generate_query(); hljs.highlightAll();" onKeyPress="onEnter(event); generate_query();hljs.highlightAll();"/>  
                  <button class="btn btn-lg btn-primary btn-block" id="suche_btn" type="button" onclick="try_login(); hljs.highlightAll();">Suchen</button>  
                  <input type="text" value="https://sql-insekten.oth-rgb.de/index.php?produkt_id=0"class="form-control" name="url" placeholder="" id='url' required="" oninput="generate_query(); hljs.highlightAll();" onKeyPress="onEnter(event);generate_query(); hljs.highlightAll();" /> 
                  <!-- <img id='sneaker_img' src="img/sneaker.png"/> -->
                  <div id='url_output'>
                    <img id='sneaker_img' src="img/sneaker.png"/>
                      <h4 id='marke'><strong>Marke: </strong> Nicke</h4>
                      <h4 id='groesse'><strong>Größe: </strong> 40 </h4>
                      <h4 id= 'price'><strong>Preis: </strong> 80€</h4>
                  </div>
                  <table id='suchergebnisse'></table>
                  <button class="btn btn-lg btn-primary btn-block" id="logout_btn" type="button" onclick="change_form();hljs.highlightAll();">Ausloggen</button> 
                </form>
              </div>
        </div>
        <div class='rsbottom'>
            <button class="btn btn-lg btn-primary btn-block" id='behindscene_btn' type="submit" onclick="show_behindscene();hljs.highlightAll();">Hintergrunddetails anzeigen</button> 
            <button class="btn btn-lg btn-primary btn-block" id='tipp_btn' type="submit" onclick="show_hints()">Tipp einblenden</button> 
            <div class='btnbox' id='btnboxre'> 
                <p class='btnboxtxt'>
                </p>
            </div>
            <div class='rsbtmleft'>
            </div>
                <div class='btnbox' id='btnboxli'> 
                    <p class='btnboxtxt'>
                        Hintergrund-Code
                        <label class="switch">
                            <input id='switcher' onclick="change_codemode()" type="checkbox" checked>
                            <span class="slider round"></span>
                        </label>
                        Erzeugte SQL-Query
                    </p>
                    <pre id="codetxt"><code>
SELECT nutzer_id, benutzername, passwort, email 
FROM benutzer 
WHERE benutzername= '' AND passwort= '';
                    </code></pre>
                    <pre id="behindcodelogin"><code >function validation(){
var uname=document.getElementById("username").value;
var pw=document.getElementById("password").value;
var ergebnis="";
var correctanswer = "";
var querysucessful = "";
// ...
query="nutzer_id, benutzername, passwort, email  FROM benutzer WHERE benutzername ='" + uname + "' AND passwort ='"+ pw + "';";
db.transaction(function(transaction) {
    transaction.executeSql(query,[],function (transaction, results) {
       <!-- if (eval(TASKS[task_index].validation[0].truecondition)) {
          querysucessful="true";
          correctanswer= TASKS[0]['validation'][0]['correctanswer'][0]
       } else {
          querysucessful="false";
          correctanswer= TASKS[task_index].validation[0].correctanswer[1];
       } -->
       // Die excuteSQL Funktion springt hier rein, falls die Query einen keinen SQL-Fehler aufweist.
       // querysucessfull und correctanswer werden hier abhängig vom Level zugewiesen.
       ergebnis= results;
    },function(transaction,error){
          <!-- correctanswer = TASKS[task_index].validation[0].correctanswer[2];
          querysucessful="error"; -->
          // Die excuteSQL Funktion springt hier rein, falls die Query einen SQL-Fehler aufweist.
          // querysucessfull und correctanswer werden hier abhängig vom Level zugewiesen.
                   }
             );
          }
       );
<!-- var correct=answer(correctanswer); -->
form_success(ergebnis,querysucessful,correctanswer);

}
function form_success(ergebnis,query,successfull,correct){
    if(querysuccessful=="true"){
        document.getElementById('loginlabel').innerHTML= "Login war erfolgreich. Willkommen " + ergebnis[index].rows.item(0)['benutzername'] +"!";
    }else if(querysuccessful=="false"){
        document.getElementById('loginlabel').innerHTML= "Login fehlgeschlagen";
    }else{
        document.getElementById('loginlabel').innerHTML= "Internal Server Error";
    }
}
// ...</code></pre>
                   <pre id="behindcodesearch"><code ># ...
def validation():
    search=document.getElementById("suchleiste").value
    query="SELECT produkt_id, marke, groesse, preis FROM schuhe WHERE marke='" + search + "';"
    ergebnis=[]
    correctanswer = ""
    querysucessful = ""
    # ...
    try:
        cursor = connection.cursor()
        cursor.execute(query)
        results = cursor.fetchall()
        for data_out in results:  
                ergebnis.append(data_out[1])  
        <!-- if (eval(TASKS[task_index]['validation'][0]['truecondition'])):
            querysucessful="true"
            correctanswer= TASKS[task_index]['validation'][0]['correctanswer'][0]
        else:
            querysucessful="false";
            correctanswer= TASKS[task_index]['validation'][0]['correctanswer'][1] -->

        # querysucessfull und correctanswer werden hier abhängig vom Level zugewiesen.
        cursor.close()

    except sqlite3.Error as error:
        <!-- correctanswer = TASKS[task_index]['validation'][0]['correctanswer'][2]
        querysucessful="error" -->
        # Die excute Funktion springt hier rein, falls die Query einen SQL-Fehler aufweist.
        # querysucessfull und correctanswer werden hier abhängig vom Level zugewiesen.
    finally:
        if connection:
            connection.close()
            
    form_success(ergebnis,querysucessful,correctanswer)

def form_success(ergebnis,querysucessful,correct):
    if(querysuccessful=="true" or querysuccessful=="false"):
        document.getElementById('loginlabel').innerHTML=  "Suchergebnisse";
        generate_resulttable(ergebnis[index]); 
    else:
        document.getElementById('loginlabel').innerHTML= "Internal Server Error"

def generate_resulttable(ergebnis):
    columns= ["produkt_id","marke","groesse","preis"]
    table=tabulate(ergebnis,headers= columns)
    document.getElementById("table")=table
# ...
</code></pre> 
                  <pre id="behindcodeurl"><code >function validation(){
$url=(string) $doc->getElementById('url')->value;
$id=explode("?", $url );
$query="SELECT marke, groesse, preis FROM schuhe WHERE " + id[id.length-1]+"";
$ergebnis="";
$correctanswer = "";
$querysucessful = "";
/* ... */

<!-- $db->transaction(function($transaction) {
    $transaction->executeSql($query,[],function ($transaction, $results) {
        if (eval($TASKS[task_index].validation[0].truecondition)) {
            $querysucessful="true";
            $correctanswer= $TASKS[task_index]['validation'][0]['correctanswer'][0];
        } else {
            $querysucessful="false";
            $correctanswer= $TASKS[task_index]['validation'][0]['correctanswer'][1];
        }
        $ergebnis= $results;
    },function($transaction,$error){
        $correctanswer = $TASKS[task_index]['validation'][0]['correctanswer'][2];
        $querysucessful="error";
    }
    );
}); -->
$sth = $dbh->query($query);
$ergebnis = $stm->fetchAll();
// querysucessfull und correctanswer werden hier abhängig vom Level und vom SQL-Fehler zugewiesen.
form_success($ergebnis,$querysucessful,$correctanswer);
}    
function form_success($ergebnis,$querysucessful,$correctanswer){
    if($querysuccessful=="true"){
        $doc->getElementById('sneaker_img')->style->display='block';
        $doc->getElementById('url_output')->style->display='block';
        $doc->getElementById('login_label')->innerHTML="Ergebnis";
        $doc->getElementById('login_label')->innerHTML="<strong>Marke:   </strong>".$ergebnis[0][1];
        $doc->getElementById('login_label')->innerHTML="<strong>Größe:   </strong>".$ergebnis[0][2];
        $doc->getElementById('login_label')->innerHTML="<strong>Preis:   </strong>".$ergebnis[0][3]."€";
    }else if($querysuccessful=="false"){
        $doc->getElementById('login_label')->innerHTML= "kein Suchergebnis";
    }else{
        $doc->getElementById('login_label')->innerHTML= "Internal Server Error";
    }
 
}           
</code></pre> 
                </div>


            
        </div>

        
    </div>
    <div class='bottom'>
        <br>
        <button id='info_btn' onclick="show_info()"><img id='info' src="https://img.icons8.com/ios/50/000000/info--v4.png"/></button> 
        <div id='modal' class='modal'>
            <div class="modal-content">
                <span class="close" onclick="close_modal()">&times;</span>
                <p>            <h3>Informationen</h3>
                    <h5><a href="https://icons8.com/icon/ZiRwjHmdrgtj/info">Info icon by Icons8</a><br>
                    <a target="_blank" href="https://icons8.com/icon/19209/light">Light</a> icon by <a target="_blank" href="https://icons8.com">Icons8</a> <br>
                    <a href='https://de.freepik.com/vektoren/blume'>Blume Vektor erstellt von terdpongvector - de.freepik.com</a><br>
                    <div>Icons made by <a href="https://www.flaticon.com/authors/itim2101" title="itim2101">itim2101</a> from <a href="https://www.flaticon.com/" title="Flaticon">www.flaticon.com</a></div></h5>
                    <button class="btn btn-lg btn-primary btn-block" id='btn_modal' type="submit" onclick="close_modal()">Ok</button>
                </p>
              
                </div>
    </div>

    </div>

</body>
</html> 
</html> 